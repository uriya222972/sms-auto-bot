<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ממשק טלפנים</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #f1f8e9;
      padding: 30px;
      direction: rtl;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      color: #388e3c;
      margin-bottom: 20px;
    }
    label {
      font-weight: bold;
    }
    input[type="text"], select {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      margin-bottom: 15px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #388e3c;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }
    button:hover {
      background-color: #2e7d32;
    }
    .message-box {
      background: #e0f2f1;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 15px;
      text-align: center;
      font-size: 18px;
    }
  </style>
  <script>
    let currentName = "";
    function saveName() {
      const name = document.getElementById("nameInput").value.trim();
      if (!name) {
        alert("נא להזין שם");
        return;
      }
      localStorage.setItem("callerName", name);
      document.getElementById("nameSection").style.display = "none";
      document.getElementById("mainSection").style.display = "block";
      document.getElementById("displayName").innerText = name;
      loadNext();
    }

    function loadNext() {
      fetch("/telephony/next?name=" + encodeURIComponent(localStorage.getItem("callerName")))
        .then(res => res.json())
        .then(data => {
          if (data.next) {
            document.getElementById("nextNumber").innerText = data.next;
            document.getElementById("status").innerText = "";
            document.getElementById("responseSelect").selectedIndex = 0;
          } else {
            document.getElementById("nextNumber").innerText = "אין עוד מספרים ברשימה.";
            document.getElementById("responseSelect").style.display = "none";
            document.getElementById("submitResponse").style.display = "none";
          }
        });
    }

    function submitResponse() {
      const label = document.getElementById("responseSelect").value;
      if (!label) {
        alert("יש לבחור תגובה");
        return;
      }
      fetch("/telephony/respond", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name: localStorage.getItem("callerName"),
          response: label
        })
      }).then(() => {
        loadNext();
      });
    }
  </script>
</head>
<body>
  <div class="container">
    <div id="nameSection">
      <h2>הכנס את שמך כדי להתחיל</h2>
      <input type="text" id="nameInput" placeholder="שם טלפן">
      <button onclick="saveName()">התחל</button>
    </div>

    <div id="mainSection" style="display: none;">
      <h2>שלום <span id="displayName"></span> 👋</h2>
      <div class="message-box">
        המספר הבא להתקשרות: <strong id="nextNumber">...</strong>
      </div>

      <label for="responseSelect">בחר תגובה:</label>
      <select id="responseSelect">
        <option value="">-- בחר --</option>
        {% for digit, config in response_map.items() %}
          <option value="{{ digit }}">{{ config.label }}</option>
        {% endfor %}
      </select>

      <button id="submitResponse" onclick="submitResponse()">עדכן תגובה והבא מספר חדש</button>

      <div id="status"></div>
    </div>
  </div>
</body>
</html>
