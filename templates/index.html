<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ClickCall - 注专转 驻</title>
  <style>
    body {
      font-family: 'Varela Round', 'Segoe UI', sans-serif;
      direction: rtl;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom, #e0f7fa, #ffffff);
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ffffff;
      border-bottom: 4px solid #0072ff;
      padding: 15px 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .logo {
      font-size: 36px;
      color: #0072ff;
      font-weight: bold;
    }
    button {
      background: #0072ff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #005bb5;
    }
    h2 {
      border-bottom: 2px solid #0072ff;
      padding-bottom: 5px;
      color: #0072ff;
    }
    .progress {
      position: relative;
      background: #f1f1f1;
      border-radius: 20px;
      height: 28px;
      overflow: hidden;
      margin: 10px 0;
    }
    .progress-bar {
      height: 100%;
      line-height: 28px;
      text-align: center;
      background: linear-gradient(to right, #00c6ff, #0072ff);
      color: white;
      transition: width 0.5s;
    }
    .progress-bar.bonus {
      background: linear-gradient(to right, #ffe082, #fb8c00);
    }
    .stat-boxes {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }
    .stat-box {
      background: #ffffff;
      border: 2px solid #0072ff;
      border-left: 10px solid #0072ff;
      padding: 12px;
      border-radius: 8px;
      flex: 1 1 180px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .stat-box h3 {
      margin: 0;
      font-size: 18px;
      color: #0072ff;
    }
    .stat-box span {
      font-size: 24px;
      font-weight: bold;
    }
    form {
      margin-bottom: 30px;
    }
    fieldset {
      background: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
    }
    legend {
      font-weight: bold;
      color: #0072ff;
    }
    label {
      display: block;
      margin: 6px 0 2px;
    }
    input, textarea {
      width: 100%;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .toggle-enc {
      cursor: pointer;
      font-size: 13px;
      color: #0072ff;
      margin-bottom: 5px;
      display: inline-block;
    }
    .enc-settings {
      display: none;
      padding: 10px;
      background: #fff;
      border: 1px dashed #ccc;
      margin-top: 5px;
    }
  </style>
  <script>
    function toggleEnc(id) {
      const el = document.getElementById(id);
      el.style.display = el.style.display === 'none' ? 'block' : 'none';
    }
    function copyAllEncouragements() {
      const firstText = document.querySelector('textarea[name^="encouragements_"]').value;
      document.querySelectorAll('textarea[name^="encouragements_"]').forEach(el => el.value = firstText);
    }
  </script>
</head>
<body>
<div class="container">
  <div class="topbar">
    <div class="logo"> ClickCall</div>
    <form method="POST" action="/reset"><button type="submit">驻住 注专转</button></form>
  </div>

  <h2>注转 拽抓</h2>
  <form method="POST" action="/upload" enctype="multipart/form-data">
    <input type="file" name="file">
    <button type="submit">注</button>
  </form>

  <h2>转拽转</h2>
  <div class="progress">
    <div class="progress-bar" style="width: {{ total_sent / target_goal * 100 if target_goal else 0 }}%">
      {{ total_sent }} / {{ target_goal }} 猬锔
    </div>
  </div>
  {% if bonus_active %}
  <div class="progress">
    <div class="progress-bar bonus" style="width: {{ total_sent / bonus_goal * 100 if bonus_goal else 0 }}%">
      {{ total_sent }} / {{ bonus_goal }} 
    </div>
  </div>
  {% endif %}

  <h2>住住拽转</h2>
  <div class="stat-boxes">
    {% for label, count in stats.items() %}
      <div class="stat-box">
        <h3>{{ label }}</h3>
        <span>{{ count }}</span>
      </div>
    {% endfor %}
  </div>

  <h2>专转 转转</h2>
  <form method="POST" action="/update-settings">
    <button type="button" onclick="copyAllEncouragements()"> 砖驻 注</button>
    {% for digit, setting in response_map.items() %}
      <fieldset>
        <legend>专 {{ digit }}</legend>
        <label>砖 转:
          <input type="text" name="label_{{ digit }}" value="{{ setting.label }}">
        </label>
        <label>专砖 专:
          <input type="checkbox" name="callback_{{ digit }}" {% if setting.callback_required %}checked{% endif %}>
        </label>
        <label>砖注转 注:
          <input type="number" name="hours_{{ digit }}" value="{{ setting.hours }}">
        </label>
        <div>
          <span class="toggle-enc" onclick="toggleEnc('enc_{{ digit }}')">注转 注</span>
          <div class="enc-settings" id="enc_{{ digit }}">
            <textarea name="encouragements_{{ digit }}" rows="3">{% for msg in encouragements.get(digit, []) %}{{ msg }}{% if not loop.last %}, {% endif %}{% endfor %}</textarea>
          </div>
        </div>
      </fieldset>
    {% endfor %}
    <button type="submit"> 砖专</button>
  </form>

  <h2>专转 注专转</h2>
  <form method="POST" action="/update-config">
    <label>转 驻转:
      <input type="text" name="activation_word" value="{{ activation_word }}">
    </label>
    <label>专:
      <input type="text" name="greeting_template" value="{{ greeting_template }}">
    </label>
    <label>转转 注:
      <input type="text" name="custom_template" value="{{ template }}">
    </label>
    <label>注:
      <input type="number" name="target_goal" value="{{ target_goal }}">
    </label>
    <label>注 住:
      <input type="number" name="bonus_goal" value="{{ bonus_goal }}">
    </label>
    <label>
      <input type="checkbox" name="bonus_active" {% if bonus_active %}checked{% endif %}> 驻注 住
    </label>
    <button type="submit"> 砖专</button>
  </form>
</div>
</body>
</html>
