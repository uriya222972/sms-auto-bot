<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title> 注转 SMS</title>
    <style>
        body {
            font-family: sans-serif;
            direction: rtl;
            max-width: 1200px;
            margin: auto;
            padding: 2em;
            background: #f9f9f9;
        }
        h1 { text-align: center; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1em;
            background: white;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 0.6em;
            text-align: center;
        }
        th {
            background: #e0e0e0;
        }
        form {
            margin-top: 2em;
            padding: 1em;
            background: white;
            border: 1px solid #ccc;
        }
        label {
            display: inline-block;
            width: 8em;
            margin-left: 1em;
        }
        input[type="text"], input[type="number"] {
            width: 20em;
        }
    </style>
</head>
<body>
    <h1>注专转 砖转 SMS</h1>

    <p>住" 注转 砖砖: <strong>{{ total_sent }}</strong></p>

    <form action="/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="file" required onchange="this.form.submit()">
    </form>

    <form method="post" action="/reset" onsubmit="return confirm('驻住 转  转?')">
        <button type="submit">驻住 转</button>
    </form>

    <form method="post">
        <h2>转转 注</h2>
        <label>转转:</label>
        <input type="text" name="template" value="{{ template }}" style="width: 80%;">
        <button type="submit" name="update_template">注</button>
    </form>

    <form method="post">
        <h2>专转 转 驻 住驻专</h2>
        {% for digit, config in response_map.items() %}
            <div style="margin-bottom: 0.5em;">
                <label>住驻专 {{ digit }}:</label>
                <input type="text" name="label_{{ digit }}" value="{{ config.label }}">
                <label>专?</label>
                <input type="checkbox" name="callback_{{ digit }}" {% if config.callback_required %}checked{% endif %}>
                <label>注 (砖注转):</label>
                <input type="number" name="hours_{{ digit }}" value="{{ config.hours }}" min="0">
            </div>
        {% endfor %}
        <button type="submit" name="update_response_map">砖专 专转</button>
    </form>

    <h2>专砖转 砖转</h2>
    <table>
        <thead>
            <tr>
                <th>住'</th>
                <th>注 砖砖</th>
                <th>住驻专</th>
                <th> 砖</th>
                <th>转</th>
                <th>驻专砖</th>
                <th> 转</th>
            </tr>
        </thead>
        <tbody>
            {% for row in rows %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ send_log.get(loop.index0, {}).get("message", row) }}</td>
                <td>{{ send_log.get(loop.index0, {}).get("to", "") }}</td>
                <td>{{ send_log.get(loop.index0, {}).get("time", "") }}</td>
                <td>{{ responses.get(loop.index0, {}).get("message", "") }}</td>
                <td>{{ responses.get(loop.index0, {}).get("label", "") }}</td>
                <td>{{ responses.get(loop.index0, {}).get("time", "") }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <p><a href="/download"> 专 转 转转 志CSV</a></p>
</body>
</html>
